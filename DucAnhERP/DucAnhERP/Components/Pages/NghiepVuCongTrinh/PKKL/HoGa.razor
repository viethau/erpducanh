@page "/PKKL/HoGa"
@using DucAnhERP.ViewModel
@using DucAnhERP.Models
@using DucAnhERP.Components.Pages.Common
@using System.Linq
@using DucAnhERP.SeedWork
@using DucAnhERP.Helpers
@inject NavigationManager navigation
@inject IPKKLHoGaRepository PKKLHoGaRepository
@inject IPhanLoaiHoGaRepository PhanLoaiHoGaRepository
@inject IDanhMucRepository DanhMucRepository
@inject IDMTLThepRepository DMTLThepRepository

@inject DucAnhERP.Services.ToastService ToastService
<style>
    table {
        position: relative;
    }

        table thead tr td {
            /*   white-space: nowrap; */
            text-align: center;
            padding: 2px 5px;
        }

</style>
<div class="container-fluid">
    <div class="mt-3">
        <CustomModal IsVisible="isModalVisibleS" OnClose="HandleModalCloseS" Title="Chọn Phân loại hố ga" Size="modal-lg">
            <BodyTemplate>
                <EditForm Model="InputMDS" FormName="SearchS" OnValidSubmit="@SearchS">
                    <DataAnnotationsValidator />
                    <div class="row ">
                        <!-- Select for nhóm danh mục-->
                        <div class="col-sm-4 col-md-2 mb-2">
                            <label for="Table">Hình thức hố ga</label>
                            <Select2 Id="mySelect1S" Items="@selectHTHG" OnChange="@OnSelectChangeHTHG"></Select2>
                            <ValidationMessage For="()=>InputMDS.ThongTinChungHoGa_HinhThucHoGa"></ValidationMessage>
                        </div>
                        <div class="col-sm-4 col-md-2 mb-2">
                            <label for="Table">Kết cấu mũ mỗ</label>
                            <Select2 Id="mySelect2S" Items="@selectKCMM" OnChange="@OnSelectChangeKCMM"></Select2>
                            <ValidationMessage For="()=>InputMDS.ThongTinChungHoGa_KetCauMuMo"></ValidationMessage>
                        </div>
                        <div class="col-sm-4 col-md-2 mb-2">
                            <label for="Table">Kết cấu tường</label>
                            <Select2 Id="mySelect3S" Items="@selectKCT" OnChange="@OnSelectChangeKCT"></Select2>
                            <ValidationMessage For="()=>InputMDS.ThongTinChungHoGa_KetCauTuong"></ValidationMessage>
                        </div>
                        <div class="col-sm-4 col-md-2 mb-2">
                            <label for="Table">Hình thức móng hố ga</label>
                            <Select2 Id="mySelect4S" Items="@selectHTMHG" OnChange="@OnSelectChangeHTMHG"></Select2>
                            <ValidationMessage For="()=>InputMDS.ThongTinChungHoGa_HinhThucMongHoGa"></ValidationMessage>
                        </div>
                        <div class="col-sm-4 col-md-2 mb-2">
                            <label for="Table">Kết cấu móng</label>
                            <Select2 Id="mySelect5S" Items="@selectKCM" OnChange="@OnSelectChangeKCM"></Select2>
                            <ValidationMessage For="()=>InputMDS.ThongTinChungHoGa_KetCauMong"></ValidationMessage>
                        </div>
                        <!-- Search Button -->
                        <div class="col-sm-4 col-md-1 mb-1">
                            <label>&nbsp;</label>
                            <button type="submit" class="btn btn-primary w-100">Tìm kiếm</button>
                        </div>
                    </div>
                </EditForm>
                <div class="row mt-2 our-table">
                    <table class="table table-hover table-bordered">
                        <thead class="bg-info">
                            <tr class="nowrap">
                                <th class="text-center" rowspan="3"></th>
                                <th class="text-center" rowspan="3">STT</th>
                                <th class="text-center" colspan="8" rowspan="2">Thông tin chung hố ga</th>
                                <th class="text-center" colspan="34">Thông tin kích thước hình học hố ga</th>
                                <th class="text-center" colspan="32">Hạng mục chiếm chỗ hố ga</th>
                            </tr>
                            <tr>
                                <th class="text-center" colspan="2">Thông tin phủ bì hố ga (m)</th>
                                <th class="text-center" colspan="3">Kích thước hình học bê tông lót móng hố ga (m)</th>
                                <th class="text-center" colspan="3">Kích thước hình học bê tông móng hố ga (m)</th>
                                <th class="text-center" colspan="3">KTHH đế hố ga</th>
                                <th class="text-center" colspan="4">Kích thước hình học tường hố ga (m)</th>
                                <th class="text-center" colspan="5">KTHH dầm giữa hố ga</th>
                                <th class="text-center" colspan="3">Chất hố ga mặt trong</th>
                                <th class="text-center" colspan="3">Chất hố ga mặt ngoài, cạnh 01 +02 (m)</th>
                                <th class="text-center" colspan="4">Kích thước hình học tường mũ mố thép dưới (m)</th>
                                <th class="text-center" colspan="4">Kích thước hình học tường mũ mố thép trên (m)</th>

                                <th class="text-center" colspan="4">Hình thức đấu nối</th>
                                <th class="text-center" colspan="4">Hình thức đấu nối</th>
                                <th class="text-center" colspan="4">Hình thức đấu nối</th>
                                <th class="text-center" colspan="4">Hình thức đấu nối</th>
                                <th class="text-center" colspan="4">Hình thức đấu nối</th>
                                <th class="text-center" colspan="4">Hình thức đấu nối</th>
                                <th class="text-center" colspan="4">Hình thức đấu nối</th>
                                <th class="text-center" colspan="4">Hình thức đấu nối</th>
                            </tr>
                            <tr>
                                <th onclick="@(() => SortTable("ThongTinChungHoGa_TenHoGaSauPhanLoai"))" class="text-center sortable" rowspan="2">
                                    <div class="mr-3">
                                        Tên hố ga sau phân loại
                                        <span class="arrow @(GetSortStyle("ThongTinChungHoGa_TenHoGaSauPhanLoai"))"></span>
                                    </div>
                                </th>
                                <th onclick="@(() => SortTable("ThongTinChungHoGa_HinhThucHoGa_Name"))" class="text-center sortable" rowspan="2">
                                    <div class="mr-3">
                                        Hình thức hố ga
                                        <span class="arrow @(GetSortStyle("ThongTinChungHoGa_HinhThucHoGa_Name"))"></span>
                                    </div>
                                </th>
                                <th onclick="@(() => SortTable("ThongTinChungHoGa_KetCauMuMo_Name"))" class="text-center sortable" rowspan="2">
                                    <div class="mr-3">
                                        Kết cấu mũ mố
                                        <span class="arrow @(GetSortStyle("ThongTinChungHoGa_KetCauMuMo_Name"))"></span>
                                    </div>
                                </th>
                                <th onclick="@(() => SortTable("ThongTinChungHoGa_KetCauTuong_Name"))" class="text-center sortable" rowspan="2">
                                    <div class="mr-3">
                                        Kết cấu tường
                                        <span class="arrow @(GetSortStyle("ThongTinChungHoGa_KetCauTuong_Name"))"></span>
                                    </div>
                                </th>
                                <th onclick="@(() => SortTable("ThongTinChungHoGa_HinhThucMongHoGa_Name"))" class="text-center sortable" rowspan="2">
                                    <div class="mr-3">
                                        Hình thức móng hố ga
                                        <span class="arrow @(GetSortStyle("ThongTinChungHoGa_HinhThucMongHoGa_Name"))"></span>
                                    </div>
                                </th>
                                <th onclick="@(() => SortTable("ThongTinChungHoGa_KetCauMong_Name"))" class="text-center sortable" rowspan="2">
                                    <div class="mr-3">
                                        Kết cấu móng
                                        <span class="arrow @(GetSortStyle("ThongTinChungHoGa_KetCauMong_Name"))"></span>
                                    </div>
                                </th>
                                <th onclick="@(() => SortTable("ThongTinChungHoGa_ChatMatTrong_Name"))" class="text-center sortable" rowspan="2">
                                    <div class="mr-3">
                                        Chát mặt trong
                                        <span class="arrow @(GetSortStyle("ThongTinChungHoGa_ChatMatTrong_Name"))"></span>
                                    </div>
                                </th>
                                <th onclick="@(() => SortTable("ThongTinChungHoGa_ChatMatNgoai_Name"))" class="text-center sortable" rowspan="2">
                                    <div class="mr-3">
                                        Chát mặt ngoài
                                        <span class="arrow @(GetSortStyle("ThongTinChungHoGa_ChatMatNgoai_Name"))"></span>
                                    </div>
                                </th>

                                @* Thông tin kích thước hình học hố ga *@
                                <th>C.D dài (m)</th>
                                <th>C.rộng (m)</th>

                                <th>D (m)</th>
                                <th>R (m)</th>
                                <th>C (m)</th>

                                <th>D (m)</th>
                                <th>R (m)</th>
                                <th>C (m)</th>

                                <th>D (m)</th>
                                <th>R (m)</th>
                                <th>C (m)</th>

                                <th>D (m)</th>
                                <th>R (m)</th>
                                <th>C (m)</th>
                                <th>CD tường (m)</th>

                                <th>D (m)</th>
                                <th>R (m)</th>
                                <th>C (m)</th>
                                <th>CD dầm (m)</th>
                                <th>C.Cao dầm giữa tường so với đáy hố ga (m)</th>

                                <th>D (m)</th>
                                <th>R (m)</th>
                                <th>C (m)</th>

                                <th>D (m)</th>
                                <th>R (m)</th>
                                <th>C (m)</th>

                                <th>D (m)</th>
                                <th>R (m)</th>
                                <th>C (m)</th>
                                <th>CD tường (m)</th>

                                <th>D (m)</th>
                                <th>R (m)</th>
                                <th>C (m)</th>
                                <th>CD tường (m)</th>

                                @* Hạng mục chiếm chỗ hố ga *@
                                <th>Loại</th>
                                <th>Cạnh dài</th>
                                <th>Cạnh rộng</th>
                                <th>Cạnh chéo</th>

                                <th>Loại</th>
                                <th>Cạnh dài</th>
                                <th>Cạnh rộng</th>
                                <th>Cạnh chéo</th>

                                <th>Loại</th>
                                <th>Cạnh dài</th>
                                <th>Cạnh rộng</th>
                                <th>Cạnh chéo</th>

                                <th>Loại</th>
                                <th>Cạnh dài</th>
                                <th>Cạnh rộng</th>
                                <th>Cạnh chéo</th>

                                <th>Loại</th>
                                <th>Cạnh dài</th>
                                <th>Cạnh rộng</th>
                                <th>Cạnh chéo</th>

                                <th>Loại</th>
                                <th>Cạnh dài</th>
                                <th>Cạnh rộng</th>
                                <th>Cạnh chéo</th>

                                <th>Loại</th>
                                <th>Cạnh dài</th>
                                <th>Cạnh rộng</th>
                                <th>Cạnh chéo</th>

                                <th>Loại</th>
                                <th>Cạnh dài</th>
                                <th>Cạnh rộng</th>
                                <th>Cạnh chéo</th>
                            </tr>
                        </thead>
                        @if (listPLHGModelS.Any())
                        {

                            <tbody>
                                @{
                                    int stt = 1;
                                }
                                @foreach (var item in listPLHGModelS)
                                {

                                    <tr>
                                        <td class="d-flex nowrap">
                                            <div class="d-inline-block">
                                                <button type="button" class="btn btn-sm btn-info m-1" title="Lựa chọn" @onclick="()=>HandleChooseId(item)">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                               
                                            </div>
                                        </td>
                                        <td class="text-center">@stt</td>
                                        <td class="text-center">@item.ThongTinChungHoGa_TenHoGaSauPhanLoai </td>
                                        <td class="text-center">@item.ThongTinChungHoGa_HinhThucHoGa_Name </td>
                                        <td class="text-center">@item.ThongTinChungHoGa_KetCauMuMo_Name </td>
                                        <td class="text-center">@item.ThongTinChungHoGa_KetCauTuong_Name </td>
                                        <td class="text-center">@item.ThongTinChungHoGa_HinhThucMongHoGa_Name </td>
                                        <td class="text-center">@item.ThongTinChungHoGa_KetCauMong_Name </td>
                                        <td class="text-center">@item.ThongTinChungHoGa_ChatMatTrong_Name </td>
                                        <td class="text-center">@item.ThongTinChungHoGa_ChatMatNgoai_Name  </td>
                                        <td class="text-center">@item.PhuBiHoGa_CDai  </td>
                                        <td class="text-center">@item.PhuBiHoGa_CRong</td>
                                        <td class="text-center">@item.BeTongLotMong_D</td>
                                        <td class="text-center">@item.BeTongLotMong_R</td>
                                        <td class="text-center">@item.BeTongLotMong_C</td>
                                        <td class="text-center">@item.BeTongMongHoGa_D  </td>
                                        <td class="text-center">@item.BeTongMongHoGa_R  </td>
                                        <td class="text-center">@item.BeTongMongHoGa_C</td>
                                        <td class="text-center">@item.DeHoGa_D</td>
                                        <td class="text-center">@item.DeHoGa_R</td>
                                        <td class="text-center">@item.DeHoGa_C</td>
                                        <td class="text-center">@item.TuongHoGa_D</td>
                                        <td class="text-center">@item.TuongHoGa_R  </td>
                                        <td class="text-center">@item.TuongHoGa_C</td>
                                        <td class="text-center">@item.TuongHoGa_CdTuong</td>
                                        <td class="text-center">@item.DamGiuaHoGa_D  </td>
                                        <td class="text-center">@item.DamGiuaHoGa_R</td>
                                        <td class="text-center">@item.DamGiuaHoGa_C</td>
                                        <td class="text-center">@item.DamGiuaHoGa_CdDam</td>
                                        <td class="text-center">@item.DamGiuaHoGa_CCaoDamGiuaTuongSoVoiDayHoGa</td>
                                        <td class="text-center">@item.ChatMatTrong_D  </td>
                                        <td class="text-center">@item.ChatMatTrong_R  </td>
                                        <td class="text-center">@item.ChatMatTrong_C</td>
                                        <td class="text-center">@item.ChatMatNgoaiCanh_D</td>
                                        <td class="text-center">@item.ChatMatNgoaiCanh_R  </td>
                                        <td class="text-center">@item.ChatMatNgoaiCanh_C</td>
                                        <td class="text-center">@item.MuMoThotDuoi_D</td>
                                        <td class="text-center">@item.MuMoThotDuoi_R</td>
                                        <td class="text-center">@item.MuMoThotDuoi_C</td>
                                        <td class="text-center">@item.MuMoThotDuoi_CdTuong</td>
                                        <td class="text-center">@item.MuMoThotTren_D  </td>
                                        <td class="text-center">@item.MuMoThotTren_R</td>
                                        <td class="text-center">@item.MuMoThotTren_C</td>
                                        <td class="text-center">@item.MuMoThotTren_CdTuong</td>
                                        <td class="text-center">@item.HinhThucDauNoi1_Loai</td>
                                        <td class="text-center">@item.HinhThucDauNoi1_CanhDai</td>
                                        <td class="text-center">@item.HinhThucDauNoi1_CanhRong</td>
                                        <td class="text-center">@item.HinhThucDauNoi1_CanhCheo</td>
                                        <td class="text-center">@item.HinhThucDauNoi2_Loai</td>
                                        <td class="text-center">@item.HinhThucDauNoi2_CanhDai</td>
                                        <td class="text-center">@item.HinhThucDauNoi2_CanhRong</td>
                                        <td class="text-center">@item.HinhThucDauNoi2_CanhCheo  </td>
                                        <td class="text-center">@item.HinhThucDauNoi3_Loai</td>
                                        <td class="text-center">@item.HinhThucDauNoi3_CanhDai</td>
                                        <td class="text-center">@item.HinhThucDauNoi3_CanhRong  </td>
                                        <td class="text-center">@item.HinhThucDauNoi3_CanhCheo</td>
                                        <td class="text-center">@item.HinhThucDauNoi4_Loai</td>
                                        <td class="text-center">@item.HinhThucDauNoi4_CanhDai</td>
                                        <td class="text-center">@item.HinhThucDauNoi4_CanhRong  </td>
                                        <td class="text-center">@item.HinhThucDauNoi4_CanhCheo</td>
                                        <td class="text-center">@item.HinhThucDauNoi5_Loai</td>
                                        <td class="text-center">@item.HinhThucDauNoi5_CanhDai</td>
                                        <td class="text-center">@item.HinhThucDauNoi5_CanhRong</td>
                                        <td class="text-center">@item.HinhThucDauNoi5_CanhCheo</td>
                                        <td class="text-center">@item.HinhThucDauNoi6_Loai</td>
                                        <td class="text-center">@item.HinhThucDauNoi6_CanhDai</td>
                                        <td class="text-center">@item.HinhThucDauNoi6_CanhRong</td>
                                        <td class="text-center">@item.HinhThucDauNoi6_CanhCheo  </td>
                                        <td class="text-center">@item.HinhThucDauNoi7_Loai  </td>
                                        <td class="text-center">@item.HinhThucDauNoi7_CanhDai</td>
                                        <td class="text-center">@item.HinhThucDauNoi7_CanhRong </td>
                                        <td class="text-center">@item.HinhThucDauNoi7_CanhCheo</td>
                                        <td class="text-center">@item.HinhThucDauNoi8_Loai</td>
                                        <td class="text-center">@item.HinhThucDauNoi8_CanhDai</td>
                                        <td class="text-center">@item.HinhThucDauNoi8_CanhRong</td>
                                        <td class="text-center">@item.HinhThucDauNoi8_CanhCheo </td>
                                    </tr>
                                    stt++;
                                }

                            </tbody>
                        }
                        else
                        {
                            <tbody>
                                <tr>
                                    <td colspan="76"> Không có dữ liệu</td>
                                </tr>
                            </tbody>
                        }

                    </table>
                </div>

                @if (listPLHGModelS.Any())
                {
                    <Pagination MetaData="MetaDataS" Spread="2" SelectedPage="SelectedPageS" ChangePageSize="ChangePageSizeS"></Pagination>
                }

            </BodyTemplate>
        </CustomModal>

        <CustomModal IsVisible="isModalVisible" OnClose="HandleModalClose" Title="@TitleModal"  Size="modal-lg">
            <BodyTemplate>
                <EditForm Model="Input" OnValidSubmit="HandleValidSubmit">
                    <h5>Thông tin cấu kiện</h5>
                    <div class="row">
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="table">Chọn loại cấu kiện</label>
                            <button @onclick="ShowModalS" class="btn btn-outline-info form-control">Chọn @InputMD.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name</button>
                            @*  <Select2 Id="select1" Items="@selectPLHG" OnChange="@OnSelectChangePLHG"></Select2> *@
                            <validationmessage for="()=>Input.ThongTinChungHoGa_TenHoGaSauPhanLoai"></validationmessage>
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="ThongTinChungHoGa_HinhThucHoGa">Hình thức thi công <span class="text-danger"></span></label>
                            <InputText @bind-Value="Input.ThongTinChungHoGa_HinhThucHoGa" class="form-control" id="ThongTinChungHoGa_HinhThucHoGa" disabled />
                            <ValidationMessage For="() => Input.ThongTinChungHoGa_HinhThucHoGa" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="ThongTinChungHoGa_KetCauMuMo">Kiểu mũ mố <span class="text-danger"></span></label>
                            <InputText @bind-Value="Input.ThongTinChungHoGa_KetCauMuMo" class="form-control" id="ThongTinChungHoGa_KetCauMuMo" disabled />
                            <ValidationMessage For="() => Input.ThongTinChungHoGa_KetCauMuMo" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="table">loại bê tông</label>
                            <Select2 Id="select3" Items="@selectLBT" OnChange="@OnSelectChangeLBT"></Select2>
                            <validationmessage for="()=>Input.LoaiBeTong"></validationmessage>
                        </div>
                      
                    </div>
                    <h5>Thông tin tên công tác thực tế</h5>
                    <div class="row">
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="table">Hạng mục <span class="text-danger">*</span></label>
                            <Select2 Id="select2" Items="@selectHMTC" OnChange="@OnSelectChangeHMTC"></Select2>
                            <validationmessage for="()=>Input.HangMuc"></validationmessage>
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="HangMucCongTac">Hạng mục công tác <span class="text-danger"></span></label>
                            <InputText @oninput="OnInputChange" @bind-Value="Input.HangMucCongTac" class="form-control" id="HangMucCongTac" />
                            <ValidationMessage For="() => Input.HangMucCongTac" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="TenCongTac">Tên công tác thực tế <span class="text-danger"></span></label>
                            <InputText @oninput="OnInputChange" @bind-Value="Input.TenCongTac" class="form-control" id="TenCongTac" />
                            <ValidationMessage For="() => Input.TenCongTac" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="DonVi">Đơn vị <span class="text-danger"></span></label>
                            <InputText @oninput="OnInputChange" @bind-Value="Input.DonVi" class="form-control" id="DonVi" />
                            <ValidationMessage For="() => Input.DonVi" class="text-danger" />
                        </div>

                    </div>
                    <h5>Thông tin KTHH tính khối lượng (m3)</h5>
                    <div class="row">
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="BeTongLotMong_D">D <span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.BeTongLotMong_D" class="form-control" id="BeTongLotMong_D" disabled />
                            <ValidationMessage For="() => Input.BeTongLotMong_D" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="BeTongLotMong_R">R <span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.BeTongLotMong_R" class="form-control" id="BeTongLotMong_R" disabled />
                            <ValidationMessage For="() => Input.BeTongLotMong_R" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="BeTongLotMong_C">C <span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.BeTongLotMong_C" class="form-control" id="BeTongLotMong_C" disabled />
                            <ValidationMessage For="() => Input.BeTongLotMong_C" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="KTHH_DienTich">Diện tích <span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.KTHH_DienTich" class="form-control" id="KTHH_DienTich" />
                            <ValidationMessage For="() => Input.KTHH_DienTich" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="table">Ghi chú</label>
                            <Select2 Id="select4" Items="@selectGhiChu" OnChange="@OnSelectChangeGhiChu"></Select2>
                            <validationmessage for="()=>Input.GhiChu"></validationmessage>
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="SLCauKien">Số lượng cấu kiện <span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.SLCauKien" class="form-control" id="SLCauKien" />
                            <ValidationMessage For="() => Input.SLCauKien" class="text-danger" />
                        </div> 
                        
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="KL1CK">KL 01 CK<span class="text-danger"></span></label>
                            <InputNumber @bind-Value="Input.KL1CK" class="form-control" id="KL1CK" disabled />
                            <ValidationMessage For="() => Input.KL1CK" class="text-danger" />
                        </div>
                    </div>
                    <h5>Thông tin cạnh tính diện tích (m2)</h5>
                    <div class="row">
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="TTCDT_CDai">Cạnh dài<span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.TTCDT_CDai" class="form-control" id="TTCDT_CDai" />
                            <ValidationMessage For="() => Input.TTCDT_CDai" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="TTCDT_Crong">Cạnh rộng<span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.TTCDT_Crong" class="form-control" id="TTCDT_Crong" />
                            <ValidationMessage For="() => Input.TTCDT_Crong" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="TTCDT_Cday">Cạnh đáy<span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.TTCDT_Cday" class="form-control" id="TTCDT_Cday" />
                            <ValidationMessage For="() => Input.TTCDT_Cday" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="TTCDT_DT">Diện tích<span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.TTCDT_DT" class="form-control" id="TTCDT_DT" />
                            <ValidationMessage For="() => Input.TTCDT_DT" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="TTCDT_SLCK">Số lượng cấu kiện<span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.TTCDT_SLCK" class="form-control" id="TTCDT_SLCK" />
                            <ValidationMessage For="() => Input.TTCDT_SLCK" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="TTCDT_KL">KL <span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.TTCDT_KL" class="form-control" id="TTCDT_KL" disabled />
                            <ValidationMessage For="() => Input.TTCDT_KL" class="text-danger" />
                        </div>
                    </div>
                    <h5>Thông tin KL không phải M2,M3</h5>
                    <div class="row">
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="KLKP_KL">Khối lượng <span class="text-danger"></span></label>
                            <InputNumber @bind-Value="Input.KLKP_KL" class="form-control" id="KLKP_KL" disabled />
                            <ValidationMessage For="() => Input.KLKP_KL" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="KLKP_Sl">Số lượng<span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.KLKP_Sl" class="form-control" id="KLKP_Sl" />
                            <ValidationMessage For="() => Input.KLKP_Sl" class="text-danger" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="KL1CK_ChuaTruCC">KL 01CK Chưa trừ chiếm chỗ<span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.KL1CK_ChuaTruCC" class="form-control" id="KL1CK_ChuaTruCC" disabled />
                            <ValidationMessage For="() => Input.KL1CK_ChuaTruCC" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="KLCC1CK">KL chiếm chỗ/01CK<span class="text-danger"></span></label>
                            <InputNumber @oninput="OnInputChange" @bind-Value="Input.KLCC1CK" class="form-control" id="KLCC1CK" />
                            <ValidationMessage For="() => Input.KLCC1CK" class="text-danger" />
                        </div>
                        <div class="form-floating col-sm-6 col-md-3">
                            <label for="TKLCK_SauCC">Tổng KLCK sau chiếm chỗ<span class="text-danger"></span></label>
                            <InputNumber @bind-Value="Input.TKLCK_SauCC" class="form-control" id="TKLCK_SauCC" disabled />
                            <ValidationMessage For="() => Input.TKLCK_SauCC" class="text-danger" />
                        </div>

                    </div>

                    <DataAnnotationsValidator />
                    <ValidationSummary />
                    <div class="row mt-5 justify-content-end">
                        <button class="btn btn-primary mr-2" type="submit">Save</button>
                        <button class="btn btn-secondary" @onclick="HandleCancel">Cancel</button>
                    </div>
                </EditForm>
            </BodyTemplate>
        </CustomModal>
    </div>
    <div class="row m-3 ">
        <div class="col-md-9 col-sm-12">
            <EditForm Model="InputMD" FormName="Search" OnValidSubmit="@Search">
                <DataAnnotationsValidator />
                <div class="row">
                    @*  <div class="col-sm-4 col-md-3 mb-2">
                    <label for="Table">Loại cấu kiện</label>
                    <Select2 Id="select3" Items="@selectSearchPLHG" OnChange="@OnSelectChangeSearchPLHG"></Select2>
                    <ValidationMessage For="()=>InputMD.ThongTinChungHoGa_TenHoGaSauPhanLoai"></ValidationMessage>
                    </div>
                    <div class="form-floating col-sm-4 col-md-3">
                    <label for="Table">Loại thép</label>
                    <Select2 Id="select2" Items="@selectSearchLoaiThep" OnChange="@OnSelectChangeSearchLoaiThep"></Select2>
                    <ValidationMessage For="()=>InputMD.LoaiThep"></ValidationMessage>
                    </div> *@
                    <!-- Search Button -->
                    <div class="col-sm-4 col-md-2 mb-2">
                        <label>&nbsp;</label>
                        <button type="submit" class="btn btn-primary w-100">Tìm kiếm</button>
                    </div>
                    <div class="col-sm-4 col-md-1 mb-1">
                        <label>&nbsp;</label>
                        <button type="button" @onclick="ShowModal" class="btn btn-info form-control">Tạo mới</button>
                    </div>
                </div>
            </EditForm>
        </div>
        <div class="col-md-3 col-sm-6 text-end">
            <button class="btn btn-outline-primary me-2" @onclick="ThumbtackHeader" title="Ghim tiêu đề bảng">
                <i class="fas fa-thumbtack"></i>
            </button>
        </div>
    </div>
    <div id="tableContainer ">
        <div class="table-report ">
            <div>
                <div class=" mt-1">
                    <h5 class="mt-2">BẢNG PHÂN KHAI KHỐI LƯỢNG HỐ GA</h5>
                </div>
                <div class=" mt-2">
                    <table id="tb-left" class="table table-hover table-bordered mt-3">
                        <thead class="bg-info @thumbtack">
                            <tr>
                                <th rowspan="2"></th>
                                <th rowspan="2">STT</th>
                                <th colspan="4">Thông tin cấu kiện</th>
                                <th colspan="3">Thông tin tên công tác thực tế</th>
                                <th colspan="7">Thông tin KTHH tính khối lượng (m3)</th>
                                <th colspan="6">Thông tin cạnh tính diện tích (m2)</th>
                                <th colspan="2">Thông tin KL không phải M2,M3</th>
                                <th rowspan="2">KL 01CK Chưa trừ chiếm chỗ</th>
                                <th rowspan="2">KL chiếm chỗ/01CK </th>
                                <th rowspan="2" class="text-warning"> Tổng KLCK sau chiếm chỗ</th>
                            </tr>
                            <tr>

                                <th class="text-center">Loại cấu kiện	</th>
                                <th class="text-center">Hình thức thi công   </th>
                                <th class="text-center">Kiểu mũ mố              </th>
                                <th class="text-center">Loại bê tông            </th>
                                <th class="text-center">Hạng mục công tác       </th>
                                <th class="text-center">Tên công tác thực tế    </th>
                                <th class="text-center">Đơn vị                  </th>
                                <th class="text-center">D                       </th>
                                <th class="text-center">R                       </th>
                                <th class="text-center">C                       </th>
                                <th class="text-center">Diện tích               </th>
                                <th class="text-center">Ghi chú diện tích       </th>
                                <th class="text-center">Số lượng cấu kiện       </th>
                                <th class="text-center  text-warning">KL 01 CK </th>
                                <th class="text-center">Cạnh dài                </th>
                                <th class="text-center">Cạnh rộng               </th>
                                <th class="text-center">Cạnh đáy                </th>
                                <th class="text-center">Diện tích               </th>
                                <th class="text-center">Số lượng cấu kiện       </th>
                                <th class="text-center text-warning">KL  </th>
                                <th class="text-center">Khối lượng              </th>
                                <th class="text-center">Số lượng                </th>

                            </tr>

                        </thead>
                        @if (listPKKLHoGaModel.Any())
                        {
                            <tbody>
                                @{
                                    var tenHoGa = "";
                                    var idHoGa = "";
                                }
                                @foreach(var pl in listPLHGModel){
                                     tenHoGa = pl.ThongTinChungHoGa_TenHoGaSauPhanLoai;
                                     idHoGa = pl.Id;

                                    <tr class="bg-warning">
                                        <td></td>
                                        <td></td>
                                        <td class="text-center"> @tenHoGa</td>
                                        <td class="text-center"> @pl.ThongTinChungHoGa_HinhThucHoGa_Name      </td>
                                        <td class="text-center"> @pl.ThongTinChungHoGa_KetCauMuMo_Name      </td>
                                        <td class="text-center " colspan="23"> </td>
                                    </tr>
                                    <tr class="bg-warning">
                                        <td></td>
                                        <td class="text-bold">I</td>
                                        <td class="text-center"> </td>
                                        <td class="text-center">   </td>
                                        <td class="text-center">    </td>
                                        <td class="text-center">  </td>
                                        <td class="text-center">  Móng hố ga, hố ga @tenHoGa  </td>
                                        <td class="text-center">    Móng hố ga, hố ga @tenHoGa   </td>
                                        <td class="text-center " colspan="19"> </td>
                                    </tr>
                                        int stt = 0;
                                        @foreach (var item in listPKKLHoGaModel)
                                        {
                                            if(item.HangMuc=="1MongHoGa" && item.ThongTinChungHoGa_TenHoGaSauPhanLoai == idHoGa)
                                            {
                                                stt++;
                                                <tr>
                                                    <td class="d-flex nowrap">
                                                        <div class="d-inline-block">
                                                            <button class="btn btn-sm btn-primary m-1" title="Chỉnh sửa" @onclick="()=>HandleEdit(item.Id)">
                                                                <i class="fas fa-edit"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-primary m-1" title="Thêm vào sau" @onclick="()=>InsertLaterFlag(item.Flag)">
                                                                <i class="fas fa-plus"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-danger m-1" title="Xóa" @onclick="()=>ConfirmDelete(item.Id ,stt.ToString())">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                    <td>@stt</td>
                                                    <td class="text-center"> @item.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name</td>
                                                    <td class="text-center"> @item.ThongTinChungHoGa_HinhThucHoGa_Name      </td>
                                                    <td class="text-center"> @item.ThongTinChungHoGa_KetCauMuMo_Name      </td>
                                                    <td class="text-center"> @item.LoaiBeTong                          </td>
                                                    <td class="text-center"> @item.HangMucCongTac                      </td>
                                                    <td class="text-center"> @item.TenCongTac                          </td>
                                                    <td class="text-center"> @item.DonVi                               </td>
                                                    <td class="text-center"> @item.BeTongLotMong_D                     </td>
                                                    <td class="text-center"> @item.BeTongLotMong_R                     </td>
                                                    <td class="text-center"> @item.BeTongLotMong_C                     </td>
                                                    <td class="text-center"> @item.KTHH_DienTich                       </td>
                                                    <td class="text-center"> @item.GhiChu                              </td>
                                                    <td class="text-center"> @item.SLCauKien                           </td>
                                                    <td class="text-center"> @item.KL1CK                               </td>
                                                    <td class="text-center"> @item.TTCDT_CDai                          </td>
                                                    <td class="text-center"> @item.TTCDT_Crong                         </td>
                                                    <td class="text-center"> @item.TTCDT_Cday                          </td>
                                                    <td class="text-center"> @item.TTCDT_DT                            </td>
                                                    <td class="text-center"> @item.TTCDT_SLCK                          </td>
                                                    <td class="text-center"> @item.TTCDT_KL                            </td>
                                                    <td class="text-center"> @item.KLKP_KL                             </td>
                                                    <td class="text-center"> @item.KLKP_Sl                             </td>
                                                    <td class="text-center"> @item.KL1CK_ChuaTruCC                     </td>
                                                    <td class="text-center"> @item.KLCC1CK                             </td>
                                                    <td class="text-center"> @item.TKLCK_SauCC                         </td>
                                                </tr>
                                             }
                                        }
                                    <tr class="bg-warning">
                                        <td></td>
                                        <td class="text-bold">II</td>
                                        <td class="text-center"> </td>
                                        <td class="text-center">   </td>
                                        <td class="text-center">    </td>
                                        <td class="text-center">  </td>
                                        <td class="text-center"> Hố ga lắp đặt, hố ga  @tenHoGa  </td>
                                        <td class="text-center"> Hố ga lắp đặt, hố ga  @tenHoGa   </td>
                                        <td class="text-center " colspan="19"> </td>
                                    </tr>
                                    stt = 0;
                                    @foreach (var item in listPKKLHoGaModel)
                                    {
                                        if (item.HangMuc == "2LapDatHoGa" && item.ThongTinChungHoGa_TenHoGaSauPhanLoai == idHoGa)
                                        {
                                            stt++;
                                            <tr>
                                                <td class="d-flex nowrap">
                                                    <div class="d-inline-block">
                                                        <button class="btn btn-sm btn-primary m-1" title="Chỉnh sửa" @onclick="()=>HandleEdit(item.Id)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-primary m-1" title="Thêm vào sau" @onclick="()=>InsertLaterFlag(item.Flag)">
                                                            <i class="fas fa-plus"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-danger m-1" title="Xóa" @onclick="()=>ConfirmDelete(item.Id ,stt.ToString())">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td>@stt</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_HinhThucHoGa_Name      </td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_KetCauMuMo_Name      </td>
                                                <td class="text-center"> @item.LoaiBeTong                          </td>
                                                <td class="text-center"> @item.HangMucCongTac                      </td>
                                                <td class="text-center"> @item.TenCongTac                          </td>
                                                <td class="text-center"> @item.DonVi                               </td>
                                                <td class="text-center"> @item.BeTongLotMong_D                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_R                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_C                     </td>
                                                <td class="text-center"> @item.KTHH_DienTich                       </td>
                                                <td class="text-center"> @item.GhiChu                              </td>
                                                <td class="text-center"> @item.SLCauKien                           </td>
                                                <td class="text-center"> @item.KL1CK                               </td>
                                                <td class="text-center"> @item.TTCDT_CDai                          </td>
                                                <td class="text-center"> @item.TTCDT_Crong                         </td>
                                                <td class="text-center"> @item.TTCDT_Cday                          </td>
                                                <td class="text-center"> @item.TTCDT_DT                            </td>
                                                <td class="text-center"> @item.TTCDT_SLCK                          </td>
                                                <td class="text-center"> @item.TTCDT_KL                            </td>
                                                <td class="text-center"> @item.KLKP_KL                             </td>
                                                <td class="text-center"> @item.KLKP_Sl                             </td>
                                                <td class="text-center"> @item.KL1CK_ChuaTruCC                     </td>
                                                <td class="text-center"> @item.KLCC1CK                             </td>
                                                <td class="text-center"> @item.TKLCK_SauCC                         </td>
                                            </tr>
                                        }
                                    }
                                    <tr class="bg-warning">
                                        <td></td>
                                        <td class="text-bold">III</td>
                                        <td class="text-center"> </td>
                                        <td class="text-center">   </td>
                                        <td class="text-center">    </td>
                                        <td class="text-center">  </td>
                                        <td class="text-center"> Tường hố ga xây gạch, hố ga  @tenHoGa  </td>
                                        <td class="text-center"> Tường hố ga xây gạch, hố ga  @tenHoGa   </td>
                                        <td class="text-center " colspan="19"> </td>
                                    </tr>
                                    <tr class="bg-warning">
                                        <td></td>
                                        <td class="text-bold">III.1</td>
                                        <td class="text-center"> </td>
                                        <td class="text-center">   </td>
                                        <td class="text-center">    </td>
                                        <td class="text-center">  </td>
                                        <td class="text-center"> Tường hố ga xây gạch, hố ga   </td>
                                        <td class="text-center"> Tường hố ga xây gạch, hố ga   </td>
                                        <td class="text-center " colspan="19"> </td>
                                    </tr>
                                    stt = 0;
                                    @foreach (var item in listPKKLHoGaModel)
                                    {
                                        if (item.HangMuc == "3.1TuongHoGaXayGach" && item.ThongTinChungHoGa_TenHoGaSauPhanLoai == idHoGa)
                                        {
                                            stt++;
                                            <tr>
                                                <td class="d-flex nowrap">
                                                    <div class="d-inline-block">
                                                        <button class="btn btn-sm btn-primary m-1" title="Chỉnh sửa" @onclick="()=>HandleEdit(item.Id)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-primary m-1" title="Thêm vào sau" @onclick="()=>InsertLaterFlag(item.Flag)">
                                                            <i class="fas fa-plus"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-danger m-1" title="Xóa" @onclick="()=>ConfirmDelete(item.Id ,stt.ToString())">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td>@stt</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_HinhThucHoGa_Name      </td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_KetCauMuMo_Name      </td>
                                                <td class="text-center"> @item.LoaiBeTong                          </td>
                                                <td class="text-center"> @item.HangMucCongTac                      </td>
                                                <td class="text-center"> @item.TenCongTac                          </td>
                                                <td class="text-center"> @item.DonVi                               </td>
                                                <td class="text-center"> @item.BeTongLotMong_D                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_R                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_C                     </td>
                                                <td class="text-center"> @item.KTHH_DienTich                       </td>
                                                <td class="text-center"> @item.GhiChu                              </td>
                                                <td class="text-center"> @item.SLCauKien                           </td>
                                                <td class="text-center"> @item.KL1CK                               </td>
                                                <td class="text-center"> @item.TTCDT_CDai                          </td>
                                                <td class="text-center"> @item.TTCDT_Crong                         </td>
                                                <td class="text-center"> @item.TTCDT_Cday                          </td>
                                                <td class="text-center"> @item.TTCDT_DT                            </td>
                                                <td class="text-center"> @item.TTCDT_SLCK                          </td>
                                                <td class="text-center"> @item.TTCDT_KL                            </td>
                                                <td class="text-center"> @item.KLKP_KL                             </td>
                                                <td class="text-center"> @item.KLKP_Sl                             </td>
                                                <td class="text-center"> @item.KL1CK_ChuaTruCC                     </td>
                                                <td class="text-center"> @item.KLCC1CK                             </td>
                                                <td class="text-center"> @item.TKLCK_SauCC                         </td>
                                            </tr>
                                        }
                                    }
                                    <tr class="bg-warning">
                                        <td></td>
                                        <td class="text-bold">III.2</td>
                                        <td class="text-center"> </td>
                                        <td class="text-center">   </td>
                                        <td class="text-center">    </td>
                                        <td class="text-center">  </td>
                                        <td class="text-center"> Chát tường hố ga xây gạch   </td>
                                        <td class="text-center"> Chát tường hố ga xây gạch   </td>
                                        <td class="text-center " colspan="19"> </td>
                                    </tr>
                                    stt = 0;
                                    @foreach (var item in listPKKLHoGaModel)
                                    {
                                        if (item.HangMuc == "3.2ChatTuongHoGaXayGach" && item.ThongTinChungHoGa_TenHoGaSauPhanLoai == idHoGa)
                                        {
                                            stt++;
                                            <tr>
                                                <td class="d-flex nowrap">
                                                    <div class="d-inline-block">
                                                        <button class="btn btn-sm btn-primary m-1" title="Chỉnh sửa" @onclick="()=>HandleEdit(item.Id)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-primary m-1" title="Thêm vào sau" @onclick="()=>InsertLaterFlag(item.Flag)">
                                                            <i class="fas fa-plus"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-danger m-1" title="Xóa" @onclick="()=>ConfirmDelete(item.Id ,stt.ToString())">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td>@stt</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_HinhThucHoGa_Name      </td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_KetCauMuMo_Name      </td>
                                                <td class="text-center"> @item.LoaiBeTong                          </td>
                                                <td class="text-center"> @item.HangMucCongTac                      </td>
                                                <td class="text-center"> @item.TenCongTac                          </td>
                                                <td class="text-center"> @item.DonVi                               </td>
                                                <td class="text-center"> @item.BeTongLotMong_D                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_R                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_C                     </td>
                                                <td class="text-center"> @item.KTHH_DienTich                       </td>
                                                <td class="text-center"> @item.GhiChu                              </td>
                                                <td class="text-center"> @item.SLCauKien                           </td>
                                                <td class="text-center"> @item.KL1CK                               </td>
                                                <td class="text-center"> @item.TTCDT_CDai                          </td>
                                                <td class="text-center"> @item.TTCDT_Crong                         </td>
                                                <td class="text-center"> @item.TTCDT_Cday                          </td>
                                                <td class="text-center"> @item.TTCDT_DT                            </td>
                                                <td class="text-center"> @item.TTCDT_SLCK                          </td>
                                                <td class="text-center"> @item.TTCDT_KL                            </td>
                                                <td class="text-center"> @item.KLKP_KL                             </td>
                                                <td class="text-center"> @item.KLKP_Sl                             </td>
                                                <td class="text-center"> @item.KL1CK_ChuaTruCC                     </td>
                                                <td class="text-center"> @item.KLCC1CK                             </td>
                                                <td class="text-center"> @item.TKLCK_SauCC                         </td>
                                            </tr>
                                        }
                                    }
                                    <tr class="bg-warning">
                                        <td></td>
                                        <td class="text-bold">IV</td>
                                        <td class="text-center"> </td>
                                        <td class="text-center">   </td>
                                        <td class="text-center">    </td>
                                        <td class="text-center">  </td>
                                        <td class="text-center"> Tường hố ga bê tông, hố ga @tenHoGa </td>
                                        <td class="text-center"> Tường hố ga bê tông, hố ga @tenHoGa  </td>
                                        <td class="text-center " colspan="19"> </td>
                                    </tr>
                                    <tr class="bg-warning">
                                        <td></td>
                                        <td class="text-bold">IV.1</td>
                                        <td class="text-center"> </td>
                                        <td class="text-center">   </td>
                                        <td class="text-center">    </td>
                                        <td class="text-center">  </td>
                                        <td class="text-center"> Tường hố ga bê tông, hố ga</td>
                                        <td class="text-center"> Tường hố ga bê tông, hố ga </td>
                                        <td class="text-center " colspan="19"> </td>
                                    </tr>
                                    stt = 0;
                                    @foreach (var item in listPKKLHoGaModel)
                                    {
                                        if (item.HangMuc == "4.1TuongHoGaBeTong" && item.ThongTinChungHoGa_TenHoGaSauPhanLoai == idHoGa)
                                        {
                                            stt++;
                                            <tr>
                                                <td class="d-flex nowrap">
                                                    <div class="d-inline-block">
                                                        <button class="btn btn-sm btn-primary m-1" title="Chỉnh sửa" @onclick="()=>HandleEdit(item.Id)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-primary m-1" title="Thêm vào sau" @onclick="()=>InsertLaterFlag(item.Flag)">
                                                            <i class="fas fa-plus"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-danger m-1" title="Xóa" @onclick="()=>ConfirmDelete(item.Id ,stt.ToString())">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td>@stt</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_HinhThucHoGa_Name      </td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_KetCauMuMo_Name      </td>
                                                <td class="text-center"> @item.LoaiBeTong                          </td>
                                                <td class="text-center"> @item.HangMucCongTac                      </td>
                                                <td class="text-center"> @item.TenCongTac                          </td>
                                                <td class="text-center"> @item.DonVi                               </td>
                                                <td class="text-center"> @item.BeTongLotMong_D                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_R                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_C                     </td>
                                                <td class="text-center"> @item.KTHH_DienTich                       </td>
                                                <td class="text-center"> @item.GhiChu                              </td>
                                                <td class="text-center"> @item.SLCauKien                           </td>
                                                <td class="text-center"> @item.KL1CK                               </td>
                                                <td class="text-center"> @item.TTCDT_CDai                          </td>
                                                <td class="text-center"> @item.TTCDT_Crong                         </td>
                                                <td class="text-center"> @item.TTCDT_Cday                          </td>
                                                <td class="text-center"> @item.TTCDT_DT                            </td>
                                                <td class="text-center"> @item.TTCDT_SLCK                          </td>
                                                <td class="text-center"> @item.TTCDT_KL                            </td>
                                                <td class="text-center"> @item.KLKP_KL                             </td>
                                                <td class="text-center"> @item.KLKP_Sl                             </td>
                                                <td class="text-center"> @item.KL1CK_ChuaTruCC                     </td>
                                                <td class="text-center"> @item.KLCC1CK                             </td>
                                                <td class="text-center"> @item.TKLCK_SauCC                         </td>
                                            </tr>
                                        }
                                    }
                                    <tr class="bg-warning">
                                        <td></td>
                                        <td class="text-bold">IV.2</td>
                                        <td class="text-center"> </td>
                                        <td class="text-center">   </td>
                                        <td class="text-center">    </td>
                                        <td class="text-center">  </td>
                                        <td class="text-center"> Tường hố ga bê tông, hố ga</td>
                                        <td class="text-center"> Tường hố ga bê tông, hố ga </td>
                                        <td class="text-center " colspan="19"> </td>
                                    </tr>
                                    stt = 0;
                                    @foreach (var item in listPKKLHoGaModel)
                                    {
                                        if (item.HangMuc == "4.2VanKhuanTuongHoGaBeTong" && item.ThongTinChungHoGa_TenHoGaSauPhanLoai == idHoGa)
                                        {
                                            stt++;
                                            <tr>
                                                <td class="d-flex nowrap">
                                                    <div class="d-inline-block">
                                                        <button class="btn btn-sm btn-primary m-1" title="Chỉnh sửa" @onclick="()=>HandleEdit(item.Id)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-primary m-1" title="Thêm vào sau" @onclick="()=>InsertLaterFlag(item.Flag)">
                                                            <i class="fas fa-plus"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-danger m-1" title="Xóa" @onclick="()=>ConfirmDelete(item.Id ,stt.ToString())">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td>@stt</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_HinhThucHoGa_Name      </td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_KetCauMuMo_Name      </td>
                                                <td class="text-center"> @item.LoaiBeTong                          </td>
                                                <td class="text-center"> @item.HangMucCongTac                      </td>
                                                <td class="text-center"> @item.TenCongTac                          </td>
                                                <td class="text-center"> @item.DonVi                               </td>
                                                <td class="text-center"> @item.BeTongLotMong_D                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_R                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_C                     </td>
                                                <td class="text-center"> @item.KTHH_DienTich                       </td>
                                                <td class="text-center"> @item.GhiChu                              </td>
                                                <td class="text-center"> @item.SLCauKien                           </td>
                                                <td class="text-center"> @item.KL1CK                               </td>
                                                <td class="text-center"> @item.TTCDT_CDai                          </td>
                                                <td class="text-center"> @item.TTCDT_Crong                         </td>
                                                <td class="text-center"> @item.TTCDT_Cday                          </td>
                                                <td class="text-center"> @item.TTCDT_DT                            </td>
                                                <td class="text-center"> @item.TTCDT_SLCK                          </td>
                                                <td class="text-center"> @item.TTCDT_KL                            </td>
                                                <td class="text-center"> @item.KLKP_KL                             </td>
                                                <td class="text-center"> @item.KLKP_Sl                             </td>
                                                <td class="text-center"> @item.KL1CK_ChuaTruCC                     </td>
                                                <td class="text-center"> @item.KLCC1CK                             </td>
                                                <td class="text-center"> @item.TKLCK_SauCC                         </td>
                                            </tr>
                                        }
                                    }
                                    <tr class="bg-warning">
                                        <td></td>
                                        <td class="text-bold">V</td>
                                        <td class="text-center"> </td>
                                        <td class="text-center">   </td>
                                        <td class="text-center">    </td>
                                        <td class="text-center">  </td>
                                        <td class="text-center">Mũ mố hố ga, hố ga @tenHoGa</td>
                                        <td class="text-center"> Mũ mố hố ga, hố ga @tenHoGa</td>
                                        <td class="text-center " colspan="19"> </td>
                                    </tr>
                                    stt = 0;
                                    @foreach (var item in listPKKLHoGaModel)
                                    {
                                        if (item.HangMuc == "5MuMoHoGa" && item.ThongTinChungHoGa_TenHoGaSauPhanLoai == idHoGa)
                                        {
                                            stt++;
                                            <tr>
                                                <td class="d-flex nowrap">
                                                    <div class="d-inline-block">
                                                        <button class="btn btn-sm btn-primary m-1" title="Chỉnh sửa" @onclick="()=>HandleEdit(item.Id)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-primary m-1" title="Thêm vào sau" @onclick="()=>InsertLaterFlag(item.Flag)">
                                                            <i class="fas fa-plus"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-danger m-1" title="Xóa" @onclick="()=>ConfirmDelete(item.Id ,stt.ToString())">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td>@stt</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_HinhThucHoGa_Name      </td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_KetCauMuMo_Name      </td>
                                                <td class="text-center"> @item.LoaiBeTong                          </td>
                                                <td class="text-center"> @item.HangMucCongTac                      </td>
                                                <td class="text-center"> @item.TenCongTac                          </td>
                                                <td class="text-center"> @item.DonVi                               </td>
                                                <td class="text-center"> @item.BeTongLotMong_D                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_R                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_C                     </td>
                                                <td class="text-center"> @item.KTHH_DienTich                       </td>
                                                <td class="text-center"> @item.GhiChu                              </td>
                                                <td class="text-center"> @item.SLCauKien                           </td>
                                                <td class="text-center"> @item.KL1CK                               </td>
                                                <td class="text-center"> @item.TTCDT_CDai                          </td>
                                                <td class="text-center"> @item.TTCDT_Crong                         </td>
                                                <td class="text-center"> @item.TTCDT_Cday                          </td>
                                                <td class="text-center"> @item.TTCDT_DT                            </td>
                                                <td class="text-center"> @item.TTCDT_SLCK                          </td>
                                                <td class="text-center"> @item.TTCDT_KL                            </td>
                                                <td class="text-center"> @item.KLKP_KL                             </td>
                                                <td class="text-center"> @item.KLKP_Sl                             </td>
                                                <td class="text-center"> @item.KL1CK_ChuaTruCC                     </td>
                                                <td class="text-center"> @item.KLCC1CK                             </td>
                                                <td class="text-center"> @item.TKLCK_SauCC                         </td>
                                            </tr>
                                        }
                                    }
                                    <tr class="bg-warning">
                                        <td></td>
                                        <td class="text-bold">VI</td>
                                        <td class="text-center"> </td>
                                        <td class="text-center">   </td>
                                        <td class="text-center">    </td>
                                        <td class="text-center">  </td>
                                        <td class="text-center">Sản xuất + V.Chuyển B.Tông T.Phẩm hố ga @tenHoGa</td>
                                        <td class="text-center"> Sản xuất + V.Chuyển B.Tông T.Phẩm hố ga  @tenHoGa</td>
                                        <td class="text-center " colspan="19"> </td>
                                    </tr>
                                    stt = 0;
                                    @foreach (var item in listPKKLHoGaModel)
                                    {
                                        if (item.HangMuc == "6SanXuatVanCHuyenBtongTPhamHGa" && item.ThongTinChungHoGa_TenHoGaSauPhanLoai == idHoGa)
                                        {
                                            stt++;
                                            <tr>
                                                <td class="d-flex nowrap">
                                                    <div class="d-inline-block">
                                                        <button class="btn btn-sm btn-primary m-1" title="Chỉnh sửa" @onclick="()=>HandleEdit(item.Id)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-primary m-1" title="Thêm vào sau" @onclick="()=>InsertLaterFlag(item.Flag)">
                                                            <i class="fas fa-plus"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-danger m-1" title="Xóa" @onclick="()=>ConfirmDelete(item.Id ,stt.ToString())">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td>@stt</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_HinhThucHoGa_Name      </td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_KetCauMuMo_Name      </td>
                                                <td class="text-center"> @item.LoaiBeTong                          </td>
                                                <td class="text-center"> @item.HangMucCongTac                      </td>
                                                <td class="text-center"> @item.TenCongTac                          </td>
                                                <td class="text-center"> @item.DonVi                               </td>
                                                <td class="text-center"> @item.BeTongLotMong_D                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_R                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_C                     </td>
                                                <td class="text-center"> @item.KTHH_DienTich                       </td>
                                                <td class="text-center"> @item.GhiChu                              </td>
                                                <td class="text-center"> @item.SLCauKien                           </td>
                                                <td class="text-center"> @item.KL1CK                               </td>
                                                <td class="text-center"> @item.TTCDT_CDai                          </td>
                                                <td class="text-center"> @item.TTCDT_Crong                         </td>
                                                <td class="text-center"> @item.TTCDT_Cday                          </td>
                                                <td class="text-center"> @item.TTCDT_DT                            </td>
                                                <td class="text-center"> @item.TTCDT_SLCK                          </td>
                                                <td class="text-center"> @item.TTCDT_KL                            </td>
                                                <td class="text-center"> @item.KLKP_KL                             </td>
                                                <td class="text-center"> @item.KLKP_Sl                             </td>
                                                <td class="text-center"> @item.KL1CK_ChuaTruCC                     </td>
                                                <td class="text-center"> @item.KLCC1CK                             </td>
                                                <td class="text-center"> @item.TKLCK_SauCC                         </td>
                                            </tr>
                                        }
                                    }
                                    <tr class="bg-warning">
                                        <td></td>
                                        <td class="text-bold"> VI</td>
                                        <td class="text-center"> </td>
                                        <td class="text-center">   </td>
                                        <td class="text-center">    </td>
                                        <td class="text-center">  </td>
                                        <td class="text-center">Gia công, lắp dựng cốt thép hố ga  @tenHoGa</td>
                                        <td class="text-center">Gia công, lắp dựng cốt thép hố ga  @tenHoGa</td>
                                        <td class="text-center " colspan="19"> </td>
                                    </tr>
                                    stt = 0;
                                    @foreach (var item in listPKKLHoGaModel)
                                    {
                                        if (item.HangMuc == "7GiaCongLapDungCotThepHoGa" && item.ThongTinChungHoGa_TenHoGaSauPhanLoai == idHoGa)
                                        {
                                            stt++;
                                            <tr>
                                                <td class="d-flex nowrap">
                                                    <div class="d-inline-block">
                                                        <button class="btn btn-sm btn-primary m-1" title="Chỉnh sửa" @onclick="()=>HandleEdit(item.Id)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-primary m-1" title="Thêm vào sau" @onclick="()=>InsertLaterFlag(item.Flag)">
                                                            <i class="fas fa-plus"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-danger m-1" title="Xóa" @onclick="()=>ConfirmDelete(item.Id ,stt.ToString())">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td>@stt</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name</td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_HinhThucHoGa_Name      </td>
                                                <td class="text-center"> @item.ThongTinChungHoGa_KetCauMuMo_Name      </td>
                                                <td class="text-center"> @item.LoaiBeTong                          </td>
                                                <td class="text-center"> @item.HangMucCongTac                      </td>
                                                <td class="text-center"> @item.TenCongTac                          </td>
                                                <td class="text-center"> @item.DonVi                               </td>
                                                <td class="text-center"> @item.BeTongLotMong_D                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_R                     </td>
                                                <td class="text-center"> @item.BeTongLotMong_C                     </td>
                                                <td class="text-center"> @item.KTHH_DienTich                       </td>
                                                <td class="text-center"> @item.GhiChu                              </td>
                                                <td class="text-center"> @item.SLCauKien                           </td>
                                                <td class="text-center"> @item.KL1CK                               </td>
                                                <td class="text-center"> @item.TTCDT_CDai                          </td>
                                                <td class="text-center"> @item.TTCDT_Crong                         </td>
                                                <td class="text-center"> @item.TTCDT_Cday                          </td>
                                                <td class="text-center"> @item.TTCDT_DT                            </td>
                                                <td class="text-center"> @item.TTCDT_SLCK                          </td>
                                                <td class="text-center"> @item.TTCDT_KL                            </td>
                                                <td class="text-center"> @item.KLKP_KL                             </td>
                                                <td class="text-center"> @item.KLKP_Sl                             </td>
                                                <td class="text-center"> @item.KL1CK_ChuaTruCC                     </td>
                                                <td class="text-center"> @item.KLCC1CK                             </td>
                                                <td class="text-center"> @item.TKLCK_SauCC                         </td>
                                            </tr>
                                        }
                                    }
                                }
                            </tbody>
                        }
                        else
                        {
                            <tbody>
                                <tr>
                                    <td colspan="27"> Không có dữ liệu</td>
                                </tr>
                            </tbody>
                        }


                    </table>
                </div>
                <div class="mt-4">
                    @if (listPKKLHoGaModel.Any())
                    {
                        <Pagination MetaData="MetaData" Spread="2" SelectedPage="SelectedPage" ChangePageSize="ChangePageSize"></Pagination>
                    }
                </div>
            </div>
        </div>
    </div>
    <ConfirmModal @ref="confirmModal" OnResponseClick="HandleResponseClick"></ConfirmModal>
    <Loading IsLoading="@isLoading" LoadingText="Đang tải dữ liệu..." />
</div>


@code {
    PhanLoaiHoGaModel plhgDetail = new();
    List<DanhMuc1> listDanhMuc = new();
    private bool isLoading = false;
    private bool isModalVisible = false;
    private bool isModalVisibleS = false;
    private string TitleModal = "Thêm mới ";
    bool isEdit = false;
    string thumbtack = "";
    private DateTime baseTime;

    [Parameter]
    public ConfirmModal confirmModal { get; set; }

    private PKKLHoGa Input = new PKKLHoGa();
    private PKKLHoGaModel InputMD = new PKKLHoGaModel();
    public PhanLoaiHoGaModel InputMDS = new ();

    private List<SelectedItem> selectHMTC = new List<SelectedItem>
    {
        new SelectedItem { Value = "", Text = "Chọn...", IsSelected = true },
        new SelectedItem { Value = "1MongHoGa", Text = "I.Móng hố ga, hố ga" },
        new SelectedItem { Value = "2LapDatHoGa", Text = "II.Hố ga lắp đặt, hố ga "},
        new SelectedItem { Value = "3.1TuongHoGaXayGach", Text = "III.1Tường hố ga xây gạch"},
        new SelectedItem { Value = "3.2ChatTuongHoGaXayGach", Text = "III.2Chát tường hố ga xây gạch"},
        new SelectedItem { Value = "4.1TuongHoGaBeTong", Text = "IV.1Tường hố ga bê tông"},
        new SelectedItem { Value = "4.2VanKhuanTuongHoGaBeTong", Text = "IV.2Ván khuân tường hố ga bê tông"},
        new SelectedItem { Value = "5MuMoHoGa", Text = "V.Mũ mố hố ga, hố ga "},
        new SelectedItem { Value = "6SanXuatVanCHuyenBtongTPhamHGa", Text = "VI.Sản xuất + V.Chuyển B.Tông T.Phẩm hố ga "},
        new SelectedItem { Value = "7GiaCongLapDungCotThepHoGa", Text = "VII.Gia công, lắp dựng cốt thép hố ga "},
    };
    private void OnSelectChangeHMTC(SelectedItem selectedItem)
    {
        Input.HangMuc = selectedItem.Value;
    }

    private List<SelectedItem> selectGhiChu = new List<SelectedItem>
    {
        new SelectedItem { Value = "", Text = "Chọn...", IsSelected = true },
        new SelectedItem { Value = "Rộng*Cao", Text = "Rộng*Cao" },
        new SelectedItem { Value = "Dài*Cao", Text = "Dài*Cao"},
        new SelectedItem { Value = "Dài*Rộng", Text = "Dài*Rộng"},
    };
    private void OnSelectChangeGhiChu(SelectedItem selectedItem)
    {
        Input.GhiChu = selectedItem.Value;
    }

    private List<SelectedItem> selectLBT = new List<SelectedItem>
    {
        new SelectedItem { Value = "", Text = "Chọn...", IsSelected = true },
        new SelectedItem { Value = "Bê tông thương phẩm", Text = "Bê tông thương phẩm" },
    };
    private void OnSelectChangeLBT(SelectedItem selectedItem)
    {
        Input.LoaiBeTong = selectedItem.Value;
    }

    private List<SelectedItem> selectPLHG = new();
    private async void OnSelectChangePLHG(SelectedItem selectedItem)
    {

        try
        {
            Input.ThongTinChungHoGa_TenHoGaSauPhanLoai = selectedItem.Value;
            InputMD.ThongTinChungHoGa_TenHoGaSauPhanLoai = selectedItem.Value;
            InputMD.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name = selectedItem.Text;
            PhanLoaiHoGaModel plhgModel = new PhanLoaiHoGaModel();
            if (!string.IsNullOrEmpty(Input.ThongTinChungHoGa_TenHoGaSauPhanLoai))
            {
                plhgModel.Id = Input.ThongTinChungHoGa_TenHoGaSauPhanLoai;

                plhgDetail = await PhanLoaiHoGaRepository.GetIdByVM(plhgModel);
                Input.ThongTinChungHoGa_HinhThucHoGa = plhgDetail.ThongTinChungHoGa_HinhThucHoGa_Name ?? "";
                Input.ThongTinChungHoGa_KetCauMuMo = plhgDetail.ThongTinChungHoGa_KetCauMuMo_Name ?? "";
                Input.ThongTinChungHoGa_HinhThucHoGa = plhgDetail.ThongTinChungHoGa_HinhThucHoGa_Name ?? "";
                if (Input.ThongTinChungHoGa_HinhThucHoGa.ToUpper().Trim() == "Thi công trực tiếp".ToUpper().Trim())
                {
                    Input.BeTongLotMong_D = (double)plhgDetail.BeTongLotMong_D;
                    Input.BeTongLotMong_R = (double)plhgDetail.BeTongLotMong_R;
                    Input.BeTongLotMong_C = (double)plhgDetail.BeTongLotMong_C;

                }

                await InvokeAsync(() =>
                  {
                      StateHasChanged();
                  });
            }
        }
        catch (Exception ex)
        {
            ToastService.ShowToast(
                       "Thông báo",
                        ex.Message,
                        cssClass: "toast-danger",
                        iconClass: "fa fa-exclamation-circle",
                        progressBarClass: "bg-info",
                        duration: 5000);
        }
    }
    private List<SelectedItem> selectSearchPLHG = new();
    private void OnSelectChangeSearchPLHG(SelectedItem selectedItem)
    {
        InputMD.ThongTinChungHoGa_TenHoGaSauPhanLoai = selectedItem.Value;
    }

    public string LoaiThep = "";

    public List<PhanLoaiHoGaModel> listPLHGModel = new();
    public List<PKKLHoGaModel> listPKKLHoGaModel { get; set; } = new();
    public List<PKKLHoGaModel> listModel { get; set; } = new();
    public MetaData MetaData { get; set; }
    public PKKLHoGaModel pKKLHoGaModel { get; set; }


    //search 

    private List<SelectedItem> selectHTHG = new();
    private List<SelectedItem> selectKCMM = new();
    private List<SelectedItem> selectKCT = new();
    private List<SelectedItem> selectHTMHG = new();
    private List<SelectedItem> selectKCM = new();
    private void OnSelectChangeHTHG(SelectedItem selectedItem)
    {
        InputMDS.ThongTinChungHoGa_HinhThucHoGa = selectedItem.Value;
    }
    private void OnSelectChangeKCMM(SelectedItem selectedItem)
    {
        InputMDS.ThongTinChungHoGa_KetCauMuMo = selectedItem.Value;
    }
    private void OnSelectChangeKCT(SelectedItem selectedItem)
    {
        InputMDS.ThongTinChungHoGa_KetCauTuong = selectedItem.Value;
    }
    private void OnSelectChangeHTMHG(SelectedItem selectedItem)
    {
        InputMDS.ThongTinChungHoGa_HinhThucMongHoGa = selectedItem.Value;
    }
    private void OnSelectChangeKCM(SelectedItem selectedItem)
    {
        InputMDS.ThongTinChungHoGa_KetCauMong = selectedItem.Value;
    }

    public async Task SearchS()
    {
        dmModelS.PageNumber = 1;
        await LoadDataPLHG();
    }
    public List<PhanLoaiHoGaModel> listPLHGModelS { get; set; } = new();
    public List<PhanLoaiHoGaModel> listModelS { get; set; } = new();
    public MetaData MetaDataS { get; set; }
    public PhanLoaiHoGaModel dmModelS { get; set; }

    //bắt sự kiện khi thay đổi
    private System.Timers.Timer _typingTimer;
    private int _delay = 2000; // Thời gian chờ (2000ms)
    private void OnInputChange(ChangeEventArgs e)
    {
        // Dừng timer nếu đang chạy
        _typingTimer?.Stop();

        // Khởi động lại timer
        _typingTimer = new System.Timers.Timer(_delay);
        _typingTimer.Elapsed += OnTypingStopped;
        _typingTimer.AutoReset = false;
        _typingTimer.Start();
    }

    private async void OnTypingStopped(object sender, System.Timers.ElapsedEventArgs e)
    {
        try
        {
            Input.KL1CK = KL1CK(Input.DonVi, Input.GhiChu, Input.BeTongLotMong_D, Input.BeTongLotMong_R, Input.BeTongLotMong_C, Input.KTHH_DienTich);
            Input.TTCDT_KL = TTCDT_KL(Input.DonVi, Input.BeTongLotMong_D, Input.BeTongLotMong_R, Input.BeTongLotMong_C, Input.TTCDT_CDai, Input.TTCDT_Crong, Input.TTCDT_Cday, Input.TTCDT_DT);
            Input.KL1CK_ChuaTruCC = KL1CK_ChuaTruCC(Input.KL1CK, Input.SLCauKien, Input.TTCDT_KL, Input.TTCDT_SLCK, Input.KLKP_KL, Input.KLKP_Sl);
            Input.TKLCK_SauCC = TKLCK_SauCC(InputMD.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name, Input.KL1CK_ChuaTruCC, Input.KLCC1CK);

            await InvokeAsync(() =>
              {
                  StateHasChanged();
              });
        }
        catch (Exception ex)
        {
            ToastService.ShowToast(
                       "Thông báo",
                        ex.Message,
                        cssClass: "toast-danger",
                        iconClass: "fa fa-exclamation-circle",
                        progressBarClass: "bg-info",
                        duration: 5000);
        }
    }


    private void ShowModal()
    {
        isModalVisible = true;
        InputMD = new();
    }

    private void HandleModalClose(bool isVisible)
    {
        isModalVisible = isVisible;
        isEdit = false;
    }

    private void HandleSave()
    {
        // Logic for saving
        isModalVisible = false;
    }

    private void HandleCancel()
    {
        // Logic for canceling
        isModalVisible = false;
        isEdit = false;
    }
    //search
    private void ShowModalS()
    {
        isModalVisibleS = true;
        isModalVisible = !isModalVisible;
    }

    private void HandleModalCloseS(bool isVisible)
    {
        isModalVisibleS = isVisible;
        isModalVisible = !isModalVisible;

    }

    private void HandleSaveS()
    {
        // Logic for saving
        isModalVisibleS = false;
    }

    private void HandleCancelS()
    {
        // Logic for canceling
        isModalVisibleS = false;

    }

    // Khởi tạo màn hình
    protected override async Task OnInitializedAsync()
    {
        try
        {

            await LoadData();
            await LoadDataPLHG();
            PhanLoaiHoGaModel plhg = new();
            listPLHGModel = await PhanLoaiHoGaRepository.GetAllByVM(plhg);
            selectPLHG = new();
            listDanhMuc = await DanhMucRepository.GetAll();
            foreach (var item in listPLHGModel)
            {
                // Kiểm tra và thêm item
                if (!string.IsNullOrEmpty(item.Id) && !selectPLHG.Any(x => x.Value == item.Id))
                {
                    selectPLHG.Add(new SelectedItem
                        {
                            Value = item.Id,
                            Text = item.ThongTinChungHoGa_TenHoGaSauPhanLoai ?? ""
                        });
                }
            }
            selectPLHG.Insert(0, new SelectedItem { Value = "", Text = "Chọn...", IsSelected = true });


            foreach (var item in listDanhMuc)
            {
                // Kiểm tra xem item đã tồn tại trong danh sách hay chưa
                if (!selectHTHG.Any(x => x.Value == item.Id) && item.IdNhomDanhMuc == "HG_HTHGa")
                {
                    if (!string.IsNullOrEmpty(item.Id))
                    {
                        // Nếu chưa tồn tại, thêm item vào danh sách
                        selectHTHG.Add(new SelectedItem
                            {
                                Value = item.Id,
                                Text = item.Ten
                            });
                    }
                }
                if (!selectKCMM.Any(x => x.Value == item.Id) && item.IdNhomDanhMuc == "HG_LMMHoGa")
                {
                    if (!string.IsNullOrEmpty(item.Id))
                    {
                        // Nếu chưa tồn tại, thêm item vào danh sách
                        selectKCMM.Add(new SelectedItem
                            {
                                Value = item.Id,
                                Text = item.Ten
                            });
                    }
                }
                if (!selectKCT.Any(x => x.Value == item.Id) && item.IdNhomDanhMuc == "HG_LTHoGa")
                {
                    if (!string.IsNullOrEmpty(item.Id))
                    {
                        // Nếu chưa tồn tại, thêm item vào danh sách
                        selectKCT.Add(new SelectedItem
                            {
                                Value = item.Id,
                                Text = item.Ten
                            });
                    }
                }
                if (!selectHTMHG.Any(x => x.Value == item.Id) && item.IdNhomDanhMuc == "HG_HTMHoGa")
                {
                    if (!string.IsNullOrEmpty(item.Id))
                    {
                        // Nếu chưa tồn tại, thêm item vào danh sách
                        selectHTMHG.Add(new SelectedItem
                            {
                                Value = item.Id,
                                Text = item.Ten
                            });
                    }
                }
                if (!selectKCM.Any(x => x.Value == item.Id) && item.IdNhomDanhMuc == "HG_LMHoGa")
                {
                    if (!string.IsNullOrEmpty(item.Id))
                    {
                        // Nếu chưa tồn tại, thêm item vào danh sách
                        selectKCM.Add(new SelectedItem
                            {
                                Value = item.Id,
                                Text = item.Ten
                            });
                    }
                }
            }
            // Thêm phần tử mặc định "chọn..."
            selectHTHG.Insert(0, new SelectedItem { Value = "", Text = "Chọn...", IsSelected = true });
            selectKCMM.Insert(0, new SelectedItem { Value = "", Text = "Chọn...", IsSelected = true });
            selectKCT.Insert(0, new SelectedItem { Value = "", Text = "Chọn...", IsSelected = true });
            selectHTMHG.Insert(0, new SelectedItem { Value = "", Text = "Chọn...", IsSelected = true });
            selectKCM.Insert(0, new SelectedItem { Value = "", Text = "Chọn...", IsSelected = true });
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }
    // Truy vấn data theo điều kiện tìm kiếm
    private async Task LoadData()
    {
        try
        {
            isLoading = true;
            pKKLHoGaModel = new();
            var repository = await PKKLHoGaRepository.GetAllByVM(InputMD);
            listModel = repository;
            listPKKLHoGaModel = Paging(repository);
            isLoading = false;

        }
        catch (Exception ex)
        {
            isLoading = false;
            Console.WriteLine("Lỗi load data" + ex.Message);
            throw;
        }

    }
    private async Task LoadDataPLHG()
    {
        try
        {
            dmModelS = new();
            var plhg = await PhanLoaiHoGaRepository.GetAllByVM(InputMDS);
            listModelS = plhg;
            listPLHGModelS = PagingS(plhg);

        }
        catch (Exception ex)
        {
            Console.WriteLine("Lỗi load data" + ex.Message);
            throw;
        }

    }

    public async Task Search()
    {
        pKKLHoGaModel.PageNumber = 1;
        await LoadData();

    }

    private async Task HandleValidSubmit()
    {

        try
        {
            string[] ids = { Input.ThongTinChungHoGa_TenHoGaSauPhanLoai ?? "" };
            var isValidTenPL = await PhanLoaiHoGaRepository.CheckExclusive(ids, baseTime);
            var listExist = await PKKLHoGaRepository.GetExist(Input);
            if (isValidTenPL)
            {
                if (isEdit)
                {
                    string[] idss = { Input.Id };


                    if (listExist == null || listExist.Count == 0)
                    {
                        bool isValid = await PKKLHoGaRepository.CheckExclusive(idss, baseTime);
                        if (isValid)
                        {
                            await PKKLHoGaRepository.Update(Input);
                            isModalVisible = false;
                            Input = new PKKLHoGa();
                            isEdit = false;
                            ToastService.ShowToast(
                                "Thông báo",
                                "Cập nhật thành công.",
                                cssClass: "toast-success",
                                iconClass: "fa fa-check-circle",
                                progressBarClass: "bg-info",
                                duration: 5000
                            );
                            await LoadData();
                        }
                    }
                    else if (listExist.Count > 0 && listExist[0].Id == Input.Id)
                    {

                        await PKKLHoGaRepository.Update(Input);
                        isModalVisible = false;
                        Input = new PKKLHoGa();
                        isEdit = false;
                        ToastService.ShowToast(
                            "Thông báo",
                            "Cập nhật thành công.",
                            cssClass: "toast-success",
                            iconClass: "fa fa-check-circle",
                            progressBarClass: "bg-info",
                            duration: 5000
                        );
                        await LoadData();
                    }
                    else
                    {
                        ToastService.ShowToast(
                        "Thông báo",
                         "Đã tồn tại.",
                         cssClass: "toast-danger",
                         iconClass: "fa fa-exclamation-circle",
                         progressBarClass: "bg-info",
                         duration: 5000);
                    }

                }
                else
                {
                    if (listExist == null || listExist.Count == 0)
                    {
                        Input.ThongTinChungHoGa_HinhThucHoGa = plhgDetail.ThongTinChungHoGa_HinhThucHoGa ?? "";
                        Input.ThongTinChungHoGa_KetCauMuMo = plhgDetail.ThongTinChungHoGa_KetCauMuMo ?? "";
                        Input.ThongTinChungHoGa_HinhThucHoGa = plhgDetail.ThongTinChungHoGa_HinhThucHoGa ?? "";
                        if (Flag > 0)
                        {
                            // Thêm mới thông tin
                            var id = await PKKLHoGaRepository.InsertLaterFlag(Input, Flag);
                            isModalVisible = false;
                            Input = new PKKLHoGa();
                            ToastService.ShowToast(
                                "Thông báo",
                                "Chèn thành công.",
                                cssClass: "toast-success",
                                iconClass: "fa fa-check-circle",
                                progressBarClass: "bg-info",
                                duration: 5000
                            );
                            await LoadData();
                            Flag = 0;
                        }
                        else
                        {
                            // Thêm mới thông tin
                            await PKKLHoGaRepository.Insert(Input);
                            isModalVisible = false;
                            Input = new PKKLHoGa();
                            ToastService.ShowToast(
                                "Thông báo",
                                "Thêm thành công.",
                                cssClass: "toast-success",
                                iconClass: "fa fa-check-circle",
                                progressBarClass: "bg-info",
                                duration: 5000
                            );
                            await LoadData();
                        }
                        InputMD = new();
                    }
                    else
                    {
                        ToastService.ShowToast(
                        "Thông báo",
                         "Đã tồn tại.",
                         cssClass: "toast-danger",
                         iconClass: "fa fa-exclamation-circle",
                         progressBarClass: "bg-info",
                         duration: 5000);
                    }

                }
            }

        }
        catch (Exception ex)
        {
            ToastService.ShowToast("Thông báo", ex.Message, cssClass: "toast-danger", iconClass: "fa fa-exclamation-circle", progressBarClass: "bg-info", duration: 5000);
        }

    }

    private string deleteId;

    private async Task ConfirmDelete(string id, string Ten)
    {
        deleteId = id;
        confirmModal.Title = "Xác nhận xóa";
        confirmModal.message = $"Bạn có chắc chắn muốn xóa: {Ten}?";
        confirmModal.openModal();

    }

    private async Task HandleResponseClick(bool confirmed)
    {
        if (confirmed)
        {
            if (!string.IsNullOrEmpty(deleteId))
            {
                string[] ids = { deleteId };
                var result = await PKKLHoGaRepository.CheckExclusive(ids, baseTime);
                if (result)
                {
                    // Thực hiện hành động xóa
                    await PKKLHoGaRepository.DeleteById(deleteId);
                    ToastService.ShowToast("Thông báo", "Xóa phân loại thành công.", cssClass: "toast-success", iconClass: "fa fa-check-circle", progressBarClass: "bg-info", duration: 5000);
                    await LoadData();
                }

                deleteId = "";
            }
        }
    }


    private async Task HandleEdit(string id)
    {
        try
        {
            TitleModal = "Cập nhật loại TĐan TDẫn !";
            Input = await PKKLHoGaRepository.GetById(id);
            isEdit = true;
            isModalVisible = true;

            foreach (var item in selectPLHG)
            {
                item.IsSelected = item.Value == Input.ThongTinChungHoGa_TenHoGaSauPhanLoai;
            }
        }
        catch (Exception ex)
        {
            ToastService.ShowToast(
                 "Thông báo",
                ex.Message,
                 cssClass: "toast-danger",
               iconClass: "fa fa-exclamation-circle",
                 progressBarClass: "bg-info",
                 duration: 5000
             );
        }

    }


    private async Task HandleChooseId(PhanLoaiHoGaModel item)
    {
        try
        {
            isModalVisible = !isModalVisible;
            //kiểm tra xem Id có tồn tại hay không.
            var plgh_id = await PhanLoaiHoGaRepository.GetById(item.Id);

            Input.ThongTinChungHoGa_TenHoGaSauPhanLoai = item.Id;
            InputMD.ThongTinChungHoGa_TenHoGaSauPhanLoai = item.Id;
            InputMD.ThongTinChungHoGa_TenHoGaSauPhanLoai_Name = item.ThongTinChungHoGa_TenHoGaSauPhanLoai ?? "";
            PhanLoaiHoGaModel plhgModel = new PhanLoaiHoGaModel();
            Input.ThongTinChungHoGa_HinhThucHoGa = item.ThongTinChungHoGa_HinhThucHoGa_Name ?? "";
            Input.ThongTinChungHoGa_KetCauMuMo = item.ThongTinChungHoGa_KetCauMuMo_Name ?? "";
            Input.ThongTinChungHoGa_HinhThucHoGa = item.ThongTinChungHoGa_HinhThucHoGa_Name ?? "";
            if (Input.ThongTinChungHoGa_HinhThucHoGa.ToUpper().Trim() == "Thi công trực tiếp".ToUpper().Trim())
            {
                Input.BeTongLotMong_D = (double)item.BeTongLotMong_D;
                Input.BeTongLotMong_R = (double)item.BeTongLotMong_R;
                Input.BeTongLotMong_C = (double)item.BeTongLotMong_C;

            }
            isModalVisibleS = false;

        }
        catch (Exception ex)
        {
            ToastService.ShowToast(
                       "Thông báo",
                        ex.Message,
                        cssClass: "toast-danger",
                        iconClass: "fa fa-exclamation-circle",
                        progressBarClass: "bg-info",
                        duration: 5000);
        }

    }

    int Flag = 0;
    //thêm vào sau
    private void InsertLaterFlag(int flag)
    {
        Flag = flag;
        TitleModal = "Chèn loại cống !";
        isModalVisible = true;
    }


    // Sắp xếp data
    private void SortTable(string columnName)
    {
        listModel = SortService.SortTable(listModel, columnName);
        pKKLHoGaModel.PageNumber = 1;
        Paging(listModel);
    }


    // Get css cho chức năng sắp xếp
    private string GetSortStyle(string columnName)
    {
        return SortService.GetSortStyle(columnName);
    }

    // Xử lý trường hợp đổi page hiển thị
    private void SelectedPage(int page)
    {
        pKKLHoGaModel.PageNumber = page;
        Paging(listModel);
    }

    // Xử lý trường hợp đổi số lượng bản ghi hiển thị trên page
    private void ChangePageSize(int pageSize)
    {
        pKKLHoGaModel.PageNumber = 1;
        pKKLHoGaModel.pageSize = pageSize;
        Paging(listModel);
    }


    // Xử lý paging
    private List<PKKLHoGaModel> Paging(List<PKKLHoGaModel> listModels)
    {
        // Đếm số bản ghi thỏa mãn
        var count = listModels.Count();

        // Lọc bản ghi theo page hiện tại và page size
        listModels = listModels.Skip((pKKLHoGaModel.PageNumber - 1) * pKKLHoGaModel.PageSize).Take(pKKLHoGaModel.PageSize).ToList();

        // Xóa danh sách đang hiển thị trên màn hình
        listPKKLHoGaModel.Clear();

        // Thêm những bản ghi sau khi lọc vào danh sách hiển thị
        foreach (var major in listModels)
        {
            listPKKLHoGaModel.Add(major);
        }

        // Tạo pagelist mới

        var pagelist = new PageList<PKKLHoGaModel>(listPKKLHoGaModel, count, pKKLHoGaModel.PageNumber, pKKLHoGaModel.PageSize);
        MetaData = pagelist.MetaData;
        return listModels;
    }

    private void ThumbtackHeader()
    {
        thumbtack = thumbtack == "flex-header" ? "" : "flex-header";
    }

    // Xử lý trường hợp đổi page hiển thị
    private void SelectedPageS(int page)
    {
        dmModelS.PageNumber = page;
        PagingS(listModelS);
    }

    // Xử lý trường hợp đổi số lượng bản ghi hiển thị trên page
    private void ChangePageSizeS(int pageSize)
    {

        dmModelS.PageNumber = 1;
        dmModelS.pageSize = pageSize;
        PagingS(listModelS);
    }
    // Xử lý paging
    private List<PhanLoaiHoGaModel> PagingS(List<PhanLoaiHoGaModel> plhgs)
    {
        // Đếm số bản ghi thỏa mãn
        var count = plhgs.Count();

        // Lọc bản ghi theo page hiện tại và page size
        plhgs = plhgs.Skip((dmModelS.PageNumber - 1) * dmModelS.PageSize).Take(dmModelS.PageSize).ToList();

        // Xóa danh sách đang hiển thị trên màn hình
        listPLHGModelS.Clear();

        // Thêm những bản ghi sau khi lọc vào danh sách hiển thị
        foreach (var item in plhgs)
        {
            listPLHGModelS.Add(item);
        }

        // Tạo pagelist mới
        var pagelist = new PageList<PhanLoaiHoGaModel>(listPLHGModelS, count, dmModelS.PageNumber, dmModelS.PageSize);
        MetaDataS = pagelist.MetaData;
        return plhgs;
    }

    public double KL1CK(string DonVi, string GhiChu, double BeTongLotMong_D, double BeTongLotMong_R, double BeTongLotMong_C, double KTHH_DienTich)
    {
        double result = 0;

        // Kiểm tra nếu DonVi là "M3"
        if (DonVi == "M3")
        {
            // Nếu GhiChu rỗng hoặc bằng "0"
            if (string.IsNullOrEmpty(GhiChu) || GhiChu == "0")
            {
                result = BeTongLotMong_D * BeTongLotMong_R * BeTongLotMong_C;
            }
            else if (GhiChu == "Rộng*Cao")
            {
                result = KTHH_DienTich * BeTongLotMong_D;
            }
            else if (GhiChu == "Dài*Cao")
            {
                result = KTHH_DienTich * BeTongLotMong_R;
            }
            else if (GhiChu == "Dài*Rộng")
            {
                result = KTHH_DienTich * BeTongLotMong_C;
            }
            else
            {
                result = 0;
            }
        }
        else
        {
            result = 0;
        }
        result = Math.Round(result, 4);
        result = Math.Round(result, 3);
        return result;
    }

    public double TTCDT_KL(string DonVi, double BeTongLotMong_D, double BeTongLotMong_R, double BeTongLotMong_C, double TTCDT_CDai, double TTCDT_Crong, double TTCDT_Cday, double TTCDT_DT)
    {
        double result = 0;

        // Kiểm tra nếu DonVi là "M2"
        if (DonVi == "M2")
        {
            // Nếu TTCDT_DT rỗng hoặc bằng 0
            if (TTCDT_DT == 0)
            {
                result = (BeTongLotMong_D * BeTongLotMong_C * TTCDT_CDai) + (BeTongLotMong_R * BeTongLotMong_C * TTCDT_Crong) + (BeTongLotMong_D * BeTongLotMong_R * TTCDT_Cday);
            }
            else
            {
                result = TTCDT_DT;
            }
        }
        else
        {
            result = 0;
        }

        return result;
    }

    public double KL1CK_ChuaTruCC(double KL1CK, double SLCauKien, double TTCDT_KL, double TTCDT_SLCK, double KLKP_KL, double KLKP_Sl)
    {
        double result = 0;

        // Kiểm tra nếu KL1CK > 0
        if (KL1CK > 0)
        {
            result = KL1CK * SLCauKien;
        }
        // Kiểm tra nếu TTCDT_KL > 0
        else if (TTCDT_KL > 0)
        {
            result = TTCDT_KL * TTCDT_SLCK;
        }
        // Nếu không, sử dụng KLKP_KL * KLKP_Sl
        else
        {
            result = KLKP_KL * KLKP_Sl;
        }

        return result;
    }

    public double TKLCK_SauCC(string ThongTinChungHoGa_TenHoGaSauPhanLoai, double KL1CK_ChuaTruCC, double KLCC1CK)
    {
        double result = 0;

        // Kiểm tra nếu 2 ký tự cuối cùng của ThongTinChungHoGa_TenHoGaSauPhanLoai là "=G"
        if (ThongTinChungHoGa_TenHoGaSauPhanLoai.EndsWith("=G"))
        {
            result = 0;
        }
        else
        {
            result = KL1CK_ChuaTruCC - KLCC1CK;
        }

        return result;
    }
}
